<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom Kit | Magpie Arts</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Roboto+Serif:opsz,wght@8..144,700&display=swap" rel="stylesheet" />
  <style>
    body {
      background: #f8fbff;
      margin: 0; padding: 0;
      font-family: 'Candara', Arial, sans-serif;
      color: #222;
    }
    .prod-viewer {
      max-width: 1200px;
      margin: 40px auto 30px auto;
      display: flex;
      gap: 3.5rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 22px rgba(80,120,220,0.10);
      padding: 2.5rem 2.5rem 1.5rem 5.5rem;
      position: relative;
      user-select: none;
      flex-wrap: nowrap;
    }
    .img-section {
      width: 430px;
      min-width: 310px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      touch-action: none;
      position: relative;
    }
    .back-button-wrapper {
      position: absolute;
      top: 16px; left: 0;
      height: 38px;
      width: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 1001;
    }
    .back-button {
      background: none;
      border: none;
      width: 38px; height: 38px;
      padding: 0;
      margin: 0;
      outline: none;
      position: relative;
      display: block;
    }
    .back-button::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("https://raw.githubusercontent.com/magpieartsinfo/magpie-site/SVG/undo.svg") no-repeat center;
      background-size: contain;
    }
    .back-button svg {
      display: none;
    }
    .main-img-wrap {
      position: relative;
      width: 350px;
      height: 466px;
      overflow: hidden;
      border-radius: 15px;
      box-shadow: 0 6px 30px rgba(64, 105, 215, 0.15);
      background: #fafdff;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .main-img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 15px;
      opacity: 1;
      position: absolute;
      top: 0; left: 0;
      transition: opacity 0.5s ease;
      -webkit-user-drag: none;
      z-index: 1;
      user-select: none;
    }
    .main-img-wrap img.fade-out { opacity: 0; z-index: 0; }
    .main-img-wrap img.fade-in { opacity: 1; z-index: 1; }
    .arrow {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      font-size: 2rem;
      color: #8ba6d2;
      background: #f2faff;
      border: none;
      border-radius: 50%;
      width: 38px; height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 5;
      transition: background 0.2s;
      user-select: none;
    }
    .arrow:hover {
      background: #bbd7ff;
    }
    .arrow.left {
      left: 12px;
    }
    .arrow.right {
      right: 12px;
    }
    .thumbs {
      display: flex;
      gap: 6px;
      margin-top: 10px;
    }
    .thumbs img {
      width: 58px;
      height: 58px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #dbeffd;
      cursor: pointer;
      transition: border-color 0.2s;
      user-select: none;
    }
    .thumbs img.selected,
    .thumbs img:hover {
      border-color: #2945ba;
    }
    .detail-section {
      flex: 1;
      min-width: 330px;
      max-width: 560px;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      margin-top: 20px;
      overflow-x: auto;
    }
    .title-area {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }
    .title-area h1 {
      font-family: 'Roboto Serif', serif;
      font-weight: 900;
      font-size: 2.1rem;
      margin: 0 0 0.3rem 0;
      color: #253060;
      letter-spacing: 0.02em;
    }
    .desc-area {
      font-size: 1.05rem;
    }
    .note-hl {
      background: #fff0f3;
      border-left: 4px solid #fca5bf;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-size: 0.95rem;
      color: #9f3858;
      margin: 0 0 1rem 0;
    }
    .price-area {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.6rem;
      color: #24212a;
      margin-bottom: 1rem;
    }
    .prod-options {
      font-family: Arial, sans-serif;
    }
    .prod-options label {
      font-weight: 700;
      margin-bottom: 0.3rem;
      display: block;
    }
    .prod-options .option-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .prod-options .option-group button {
      padding: 0.8rem 1.8rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 2.5px solid #6494ff;
      cursor: pointer;
      background: #fefcff;
      color: #3a65ed;
      transition: background 0.3s ease, border-color 0.3s ease;
      user-select: none;
    }
    .prod-options .option-group button.selected {
      background: #5296fc;
      color: white;
      border-color: #5296fc;
      box-shadow: 0 0 10px #7ab7f7;
    }
    .prod-options .option-group button:disabled {
      background: #d1ddfe;
      border-color: #aec1fc;
      color: #92a8e8;
      cursor: default;
    }
    .form-row {
      margin-bottom: 1rem;
    }
    .form-row label {
      font-weight: 600;
      font-size: 1rem;
    }
    .add-cart-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    .add-cart-row button {
      flex: 1 1 150px;
      padding: 0.9rem;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 35px;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      color: white;
      user-select: none;
      box-shadow: 0 3px 7px rgba(50, 100, 220, 0.6);
      transition: background-color 0.3s ease;
    }
    .add-cart-row .add-cart-btn {
      background: linear-gradient(135deg, #3f62d1 0%, #6697ff 100%);
    }
    .add-cart-row .add-cart-btn:hover {
      background: linear-gradient(135deg, #3860cc 0%, #5789fc 100%);
    }
    .add-cart-row .buy-now-btn {
      background: #f2af1b;
      color: #3e2c00;
      box-shadow: 0 3px 7px rgba(210, 148, 20, 0.7);
    }
    .add-cart-row .buy-now-btn:hover {
      background: #d89904;
      box-shadow: 0 4px 9px rgba(183, 133, 2, 0.8);
    }
    .add-cart-row .view-cart-btn {
      background: #555;
      box-shadow: none;
      color: #ddd;
    }
    .add-cart-row .view-cart-btn:hover {
      background: #444;
      color: #eee;
    }
    .upload-photo-row {
      display: none;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }
    @media (max-width: 1024px) {
      .prod-viewer {
        flex-direction: column;
        padding: 1rem;
        gap: 1rem;
      }
      .img-section {
        order: -1;
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
      }
      .main-img-wrap {
        width: 100vw;
        max-width: 480px;
        height: calc(100vw * (466 / 350));
      }
    }
    @media (max-width: 600px) {
      .prod-viewer {
        padding: 0.8rem 0.5rem;
      }
      .img-section {
        width: 100vw;
        max-width: 95vw;
      }
      .main-img-wrap {
        width: 100vw;
        max-width: 400px;
        height: calc(100vw * (466 / 350));
      }
      .add-cart-row {
        flex-direction: column;
        gap: 1rem;
      }
      .upload-photo-row {
        margin-top: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <button class="back-button" aria-label="Back" onclick="goBack()" title="Back to Shop"></button>
  <div class="prod-viewer" id="prodViewer">
    <div class="back-button-wrapper"></div>
    <div class="img-section" id="imgSection">
      <div class="main-img-wrap" id="mainImgWrap">
        <button class="arrow left" id="leftArrow" aria-label="Previous image">&lt;</button>
        <img id="mainImage" draggable="false" alt="Product Image"/>
        <button class="arrow right" id="rightArrow" aria-label="Next image">&gt;</button>
      </div>
      <div id="thumbsContainer" class="thumbs" aria-label="Image Thumbnails"></div>
    </div>
    <div class="detail-section" id="detailSection">
      <div class="title-area" id="titleArea">
        <h1 id="productTitle">Loading...</h1>
        <div class="desc-area" id="descArea"></div>
        <span class="note-hl">* Prices above Rs. 1,399 qualify for free delivery.</span>
      </div>
      <div class="price-area" id="priceArea">
        <span id="productPrice">Rs. 0</span>
      </div>
      <form id="orderForm" onsubmit="event.preventDefault()">
        <div class="prod-options">
          <label for="sizeOptions">Size</label>
          <div class="option-group" id="sizeOptions" role="radiogroup" aria-labelledby="sizeOptionsLabel"></div>
          <label for="paletteOptions">Palette</label>
          <div class="option-group" id="paletteOptions" role="radiogroup" aria-labelledby="paletteOptionsLabel"></div>
        </div>
        <div class="form-row upload-photo-row" id="uploadPhotoRow">
          <label for="uploadInput">Upload your photo <span aria-hidden="true" style="color:red;">*</span></label>
          <input type="file" accept="image/*" id="uploadInput" />
        </div>
        <div class="add-cart-row">
          <button type="button" class="add-cart-btn" id="addCartBtn">Add to Cart</button>
          <button type="submit" class="buy-now-btn" id="buyNowBtn">Buy It Now</button>
          <button type="button" class="view-cart-btn" id="viewCartBtn">View Cart</button>
        </div>
      </form>
    </div>
  </div>
<script>
  // Initialization and element selection
  const productTitle = document.getElementById('productTitle');
  const productDesc = document.getElementById('descArea');
  const productPrice = document.getElementById('productPrice');
  const sizeOptions = document.getElementById('sizeOptions');
  const paletteOptions = document.getElementById('paletteOptions');
  const thumbsContainer = document.getElementById('thumbsContainer');
  const mainImage = document.getElementById('mainImage');
  const uploadPhotoRow = document.getElementById('uploadPhotoRow');
  const uploadInput = document.getElementById('uploadInput');
  const addCartBtn = document.getElementById('addCartBtn');
  const buyNowBtn = document.getElementById('buyNowBtn');
  const viewCartBtn = document.getElementById('viewCartBtn');

  let products = [];
  let currentProduct = null;
  let selectedSize = 0;
  let selectedPalette = 0;
  let currentImageIndex = 0;

  function goBack() {
    window.location.href = 'https://magpieartsinfo.github.io/magpie-site/shop.html';
  }
  function goToCart() {
    window.location.href = 'https://magpieartsinfo.github.io/magpie-site/cart.html';
  }

  async function fetchProducts() {
    try {
      const response = await fetch('https://raw.githubusercontent.com/magpieartsinfo/magpie-site/main/products.json');
      products = await response.json();
      loadProduct();
    } catch (e) {
      productTitle.textContent = "Failed to load product.";
      productDesc.textContent = "";
      console.error(e);
    }
  }

  function loadProduct() {
    const urlParams = new URLSearchParams(window.location.search);
    const index = Number(urlParams.get('index'));
    if (isNaN(index) || !products[index]) {
      productTitle.textContent = "Product not found.";
      productDesc.textContent = "";
      return;
    }
    currentProduct = products[index];
    setupProduct();
  }

  function setupProduct() {
    productTitle.textContent = currentProduct.title;
    productDesc.textContent = currentProduct.desc;

    // Images
    const images = [
      currentProduct.image,
      'https://raw.githubusercontent.com/magpieartsinfo/magpie-site/main/images/size-selector.png',
      'https://raw.githubusercontent.com/magpieartsinfo/magpie-site/main/images/kit-includes.png',
    ];

    currentImageIndex = 0;
    mainImage.src = images[0];

    thumbsContainer.innerHTML = '';
    images.forEach((src, i) => {
      const thumb = document.createElement('img');
      thumb.src = src;
      thumb.alt = i === 0 ? `${currentProduct.title} main image`: (i === 1 ? 'Size selector' : 'Kit includes');
      if (i === 0) thumb.classList.add('selected');
      thumb.addEventListener('click', () => {
        updateImage(i);
      });
      thumbsContainer.appendChild(thumb);
    });

    document.getElementById('leftArrow').onclick = () => updateImage((currentImageIndex - 1 + images.length) % images.length);
    document.getElementById('rightArrow').onclick = () => updateImage((currentImageIndex + 1) % images.length);

    // Touch swipe support
    let startX = 0;
    let endX = 0;
    const swipeThreshold = 50;

    mainImage.addEventListener('touchstart', e => {
      if (e.touches.length === 1) startX = e.touches[0].clientX;
    }, { passive: true });

    mainImage.addEventListener('touchmove', e => {
      if (e.touches.length === 1) endX = e.touches[0].clientX;
    }, { passive: true });

    mainImage.addEventListener('touchend', () => {
      const deltaX = endX - startX;
      if (Math.abs(deltaX) > swipeThreshold) {
        if (deltaX > 0) {
          document.getElementById('leftArrow').click();
        } else {
          document.getElementById('rightArrow').click();
        }
      }
      startX = 0;
      endX = 0;
    });

    function updateImage(index) {
      if (index === currentImageIndex) return;
      currentImageIndex = index;
      mainImage.src = images[index];
      Array.from(thumbsContainer.children).forEach((thumb, i) => {
        thumb.classList.toggle('selected', i === index);
      });
    }

    // Options
    const sizes = [
      { label: '10x12 Inch', priceKey: 'priceS1' },
      { label: '18x20 Inch', priceKey: 'priceS2' }
    ];
    const palettes = [
      { label: '16 colors', priceKey: 'C16' },
      { label: '20 colors', priceKey: 'C20' },
      { label: '24 colors', priceKey: 'C24' }
    ];

    selectedSize = 0;
    selectedPalette = 0;

    renderOptions();

    if (currentProduct.isCustomKit) {
      uploadPhotoRow.style.display = 'block';
      uploadInput.required = true;
    } else {
      uploadPhotoRow.style.display = 'none';
      uploadInput.required = false;
    }

    updatePrice();


    function renderOptions() {
      sizeOptions.innerHTML = '';
      sizes.forEach((sz, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = sz.label;
        if (i === selectedSize) btn.classList.add('selected');
        btn.addEventListener('click', () => {
          selectedSize = i;
          adjustPaletteButtons();
          updatePrice();
          renderOptions();
        });
        sizeOptions.appendChild(btn);
      });
      paletteOptions.innerHTML = '';
      palettes.forEach((pal, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = pal.label;
        if (i === selectedPalette) btn.classList.add('selected');
        if (isPaletteDisabled(i)) {
          btn.disabled = true;
          btn.classList.remove('selected');
        }
        btn.addEventListener('click', () => {
          if (!btn.disabled) {
            selectedPalette = i;
            updatePrice();
            renderOptions();
          }
        });
        paletteOptions.appendChild(btn);
      });
    }

    function isPaletteDisabled(index) {
      if (selectedSize === 0) {  // 10x12 Inch
        return index === 2;       // disable 24 colors
      } else {                   // 18x20 Inch
        return index === 0;       // disable 16 colors
      }
    }

    function adjustPaletteButtons() {
      if (isPaletteDisabled(selectedPalette)) {
        selectedPalette = selectedSize === 0 ? 0 : 1;
      }
    }

    function updatePrice() {
      const priceKey = sizes[selectedSize].priceKey + palettes[selectedPalette].priceKey;
      const price = currentProduct[priceKey] || 0;
      productPrice.textContent = 'Rs. ' + price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

  </script>
</body>
</html>
